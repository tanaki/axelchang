<% if ( slug ) { %>

	<div class="project-detail">
		
		<div class="project-images" tabindex="0">

			<div id="detail-slider" class="swipe">
				<div class="swipe-wrap">
					<% _.each( project.images, function(image, index){ %>
						<div class="mouse-move to-load-bg<%= (index == 0 ? ' move-current' : '') %>" data-item="<%= index %>">
							<img src="<%= image.low %>" alt="" data-src="<%= image.img %>" />
							<div class="credits">
								<%= image.credits %>
							</div>
						</div>
					<% }) %>
				</div>
			</div>

		</div>

		<% if ( project.images.length > 1 ) { %>
			<div class="project-nav">
				<a href="#" class="prev"><</a>
				<a href="#" class="next">></a>
			</div>
		<% } %>

		<div class="project-global-nav">
			<div class="current-index">
				<span class="current">1</span>
				<span class="total"> / <%= project.images.length %></span>
			</div>
			
			<% if ( !_.isNull(previous) && !_.isUndefined(previous) ) { %><a class="prev-project" href="/portfolio/<%= previous.slug %>"><</a><% } %>
			<span class="project-title"><%= project.title %></span>
			<% if ( !_.isNull(next) && !_.isUndefined(next) ) { %><a class="next-project" href="/portfolio/<%= next.slug %>">></a><% } %>
		</div>

		<div class="project-mobile-nav">
			<a href="#" class="link-back">Back to portfolio</a>

			<div class="mobile-index">
				<ul>
					<% _.each( project.images, function(img, index) { %>
					<li <% print( index == 0 ? 'class="current"' : '' ) %>></li>
					<% }) %>
				</ul>
			</div>
			
			<a href="#" class="link-credits">Credits</a>
			<div class="mobile-credits">
				<span class="project-title"><%= project.title %></span>
			</div>
		</div>
	</div>

<% } else { %>

	<div class="projects">
		<% 
			_.each ( projects, function ( project, index ) { 

				var 
					extraClass = "",
					extraCSS = "";

				if ( project.width > project.height ) {

					var newW = (220 * project.width) / project.height;
					extraCSS = "margin-left:" + Math.round(( 220 - newW ) * 0.5) + "px;";
					extraClass = "resized";

				} else {

					var newH = (220 * project.height) / project.width;
					extraCSS = "margin-top:" + Math.round(( 220 - newH ) * 0.5) + "px;";

				}



		%>
			<div class="project project-<%= index %> <% if ( preloaded ) { print('loaded') } %>">
				<a href="/portfolio/<%= project.slug %>">
					<span class="project-bg"></span>
					<span class="project-title"><%= project.title %></span>

					<% if ( preloaded ) { %>
						<img src="<%= project.cover %>" alt="<%= project.title %>" style="<%= extraCSS %>" class="<%= extraClass %>" />
					<% } else { %>
						<img class="to-load" src="" data-src="<%= project.cover %>" alt="<%= project.title %>" style="<%= extraCSS %>" class="<%= extraClass %>" />
					<% } %>
				</a>
			</div>
		<% }) %>
	</div>

<% } %>