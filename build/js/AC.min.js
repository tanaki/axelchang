var AC=window.AC||{};AC.EventManager=AC.EventManager||$({}),AC.Collection=AC.Collection||{},AC.Model=AC.Model||{},AC.View=AC.View||{},AC.Data=AC.Data||{},AC.Locations=AC.Locations||{},AC.Locations.Templates="/templates/",AC.Locations.Images="/img/",AC.Locations.JSON="/data/data.json",AC.Events={APP_LOADING:"APP_LOADING",SHOW_HOME:"SHOW_HOME",SHOW_PORTFOLIO:"SHOW_PORTFOLIO",SHOW_ABOUT:"SHOW_ABOUT",SHOW_CONTACT:"SHOW_CONTACT",SHOW_NEWS:"SHOW_NEWS"},$(window).ready(function(){AC.AppRouter=new AC.Router,Backbone.history.start({pushState:!0,root:AC.Locations.Root})}),AC.Controller=function(){var a=[],b=null,c=null,d=null,e=null,f=null,g=null,h=null,i=function(){j(),k()},j=function(){_.each(AC.Events,function(b){a[b]=m}),AC.EventManager.bind(a)},k=function(){$("body").delegate("a[rel=nav], nav a:not(.external)","click",function(a){a.preventDefault(),AC.AppRouter.navigate($(this).attr("href"),!0)})},l=function(a,c,d){$("nav .selected").removeClass("selected"),$("nav a[href='/"+Backbone.history.fragment+"']").addClass("selected"),b&&c?b.hide(function(){l(a,!1,d)}):(AC.EventManager.trigger(AC.Events.APP_LOADING),AC.DataManager.check(a,d))},m=function(a,i){var j;switch(a.type){case AC.Events.APP_LOADING:c||(c=new AC.View.Loading),j=c;break;case AC.Events.SHOW_HOME:d||(d=new AC.View.Home),j=d;break;case AC.Events.SHOW_ABOUT:f||(f=new AC.View.About),j=f;break;case AC.Events.SHOW_PORTFOLIO:e||(e=new AC.View.Portfolio),e.update(i.slug,i.imgIndex),j=e;break;case AC.Events.SHOW_CONTACT:h||(h=new AC.View.Contact),j=h;break;case AC.Events.SHOW_NEWS:g||(g=new AC.View.News),j=g}j.render(),b=j};return i(),{displayPage:l}},AC.DataManager=AC.DataManager||{currentEvent:null,currentSlug:null,dataLoaded:!1,check:function(a,b){var c=this;switch(c.currentEvent=a,c.currentSlug=b,c.currentEvent){case AC.Events.SHOW_HOME:case AC.Events.SHOW_ABOUT:case AC.Events.SHOW_PORTFOLIO:case AC.Events.SHOW_CONTACT:case AC.Events.SHOW_NEWS:c.dataLoaded?AC.EventManager.trigger(c.currentEvent,c.currentSlug):c.getData()}},getData:function(){var a=this;$.get(AC.Locations.JSON,function(b){AC.Data.JSON=b,a.dataLoaded=!0,a.check(a.currentEvent,a.currentSlug)})}},AC.TemplateManager=AC.TemplateManager||{templates:{},get:function(a,b,c){if(this.templates[a])return c(this.templates[a]);var d=AC.Locations.Templates+b,e=$.trafficCop(d),f=this;e.done(function(b){var d=_.template(b);f.templates[a]=d,c(d)})}},AC.Router=Backbone.Router.extend({controller:null,initialize:function(){this.controller=new AC.Controller},routes:{portfolio:"_portfolioAction","portfolio/:project":"_portfolioAction","portfolio/:project/:index":"_portfolioAction",about:"_aboutAction",contact:"_contactAction",news:"_newsAction","news/:slug":"_newsAction","*actions":"_defaultAction"},_portfolioAction:function(a,b){console.log("PF"),this.controller.displayPage(AC.Events.SHOW_PORTFOLIO,!0,{slug:a,imgIndex:b})},_aboutAction:function(){console.log("about"),this.controller.displayPage(AC.Events.SHOW_ABOUT,!0)},_contactAction:function(){console.log("contact"),this.controller.displayPage(AC.Events.SHOW_CONTACT,!0)},_newsAction:function(a){console.log("news"),this.controller.displayPage(AC.Events.SHOW_NEWS,!0,a)},_defaultAction:function(){console.log("home"),this.controller.displayPage(AC.Events.SHOW_HOME,!0)}}),AC.Model.About=Backbone.Model.extend({defaults:{id:0,title:"",slug:""},update:function(){console.log("test",AC.Data.JSON.about)}}),AC.Model.Item=Backbone.Model.extend({defaults:{id:0,title:"",slug:""},initialize:function(){},parse:function(a){return this.id=a.id,this.title=a.title,this.slug=a.slug,this}}),AC.Model.News=Backbone.Model.extend({defaults:{id:0,title:"",slug:""},initialize:function(){},parse:function(a){return this.id=a.id,this.title=a.title,this.slug=a.slug,this}}),AC.Collection.ItemCollection=Backbone.Collection.extend({model:AC.Model.Item,url:"/data/items.json",initialize:function(){},parse:function(a){return a.items}}),AC.View.Base=Backbone.View.extend({id:"",path:"",el:".main-content",tpl:null,collection:null,slug:"",params:{},hide:function(a){a&&a()},render:function(){this.params.models=this.collection?this.collection.models:null,this.params.slug=this.slug;var a=this;AC.TemplateManager.get(a.id,a.path,function(b){a.tpl=b,a._display()})},_display:function(){var a=this;$("body").attr("class","").addClass(a.id),$(this.el).html(this.tpl(this.params)),this._displayComplete()},_displayComplete:function(){},update:function(){}}),AC.View.About=AC.View.Base.extend({id:"about",path:"about.html",initialize:function(){this.params.about=AC.Data.JSON.about}}),AC.View.Contact=AC.View.Base.extend({id:"contact",path:"contact.html",initialize:function(){this.params.contact=AC.Data.JSON.contact}}),AC.View.Home=AC.View.Base.extend({id:"home",path:"home.html",initialize:function(){}}),AC.View.Loading=AC.View.Base.extend({id:"loading",path:"loading.html"}),AC.View.News=AC.View.Base.extend({id:"news",path:"news.html",initialize:function(){this.params.news=AC.Data.JSON.news}}),AC.View.Portfolio=AC.View.Base.extend({id:"portfolio",path:"portfolio.html",initedLinks:!1,slug:null,initialize:function(){this.params.projects=AC.Data.JSON.portfolio},_displayComplete:function(){$(".project-detail .project-global-nav a").on("click",function(a){a.preventDefault(),AC.AppRouter.navigate($(this).attr("href"),!0)}),this.initProjectNav()},initProjectNav:function(){var a,b,c,d=$(".project-detail .project-nav"),e=$(".project-item").length-1;$(".next",d).on("click",function(d){d.preventDefault(),a=$(".selected"),b=a.data("item"),b>=e||(a.addClass("prev").removeClass("selected"),c=b+1,$("[data-item='"+c+"']").addClass("selected"),$(".current-index .current").html(c+1))}),$(".prev",d).on("click",function(d){d.preventDefault(),a=$(".selected"),b=a.data("item"),0>=b||(a.removeClass("selected"),c=b-1,$("[data-item='"+c+"']").addClass("selected").removeClass("prev"),$(".current-index .current").html(c+1))})},update:function(a,b){var c=this,d=this.params.projects;this.imgIndex=b,this.slug=a,this.slug?(this.id="portfolio-detail",_.each(d,function(a,b){a.slug==c.slug&&(c.params.project=a,c.params.previous=b>0?d[b-1]:null,c.params.next=b<d.length?d[b+1]:null)})):this.id="portfolio"}});