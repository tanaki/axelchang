var AC=window.AC||{};AC.EventManager=AC.EventManager||$({}),AC.Collection=AC.Collection||{},AC.Model=AC.Model||{},AC.View=AC.View||{},AC.View.Components=AC.View.Components||{},AC.Data=AC.Data||{},AC.Data.FADE_IN_DURATION=400,AC.Data.FADE_OUT_DURATION=100,AC.Locations=AC.Locations||{},AC.Locations.Templates="/templates/",AC.Locations.Images="/img/",AC.Locations.JSON="/data/data.json",AC.Events={APP_LOADING:"APP_LOADING",SHOW_HOME:"SHOW_HOME",SHOW_PORTFOLIO:"SHOW_PORTFOLIO",SHOW_ABOUT:"SHOW_ABOUT",SHOW_CONTACT:"SHOW_CONTACT",SHOW_NEWS:"SHOW_NEWS"},AC.SpinOptions={lines:15,length:0,width:2,radius:15,corners:1,rotate:0,direction:1,color:"#fff",speed:1.1,trail:10,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},$(window).ready(function(){AC.Spinner=new Spinner(AC.SpinOptions).spin(),AC.AppRouter=new AC.Router,Backbone.history.start({pushState:!0,root:AC.Locations.Root}),$("body").on("mousemove",function(a){var b=$(window).height()-15,c=$(".mouse-move img",this),d=c.parent(),e=c.height(),f=e-b,g=f*(a.pageY/b);e>b?(c.css("margin-top",-g),d.removeClass("img-full").css("background-image","none")):(d.addClass("img-full").css("background-image","url("+c.attr("src")+")"),c.css("margin-top",0))})}),AC.Controller=function(){var a=[],b=null,c=null,d=null,e=null,f=null,g=null,h=null,i=function(){j(),k()},j=function(){_.each(AC.Events,function(b){a[b]=m}),AC.EventManager.bind(a)},k=function(){$("body").delegate("a[rel=nav], nav a:not(.external)","click",function(a){a.preventDefault(),AC.AppRouter.navigate($(this).attr("href"),!0)})},l=function(a,c,d){$("nav .selected").removeClass("selected"),$("nav a[href='/"+Backbone.history.fragment+"']").addClass("selected"),b&&c?b.hide(function(){l(a,!1,d)}):(AC.EventManager.trigger(AC.Events.APP_LOADING),AC.DataManager.check(a,d))},m=function(a,i){var j;switch(a.type){case AC.Events.APP_LOADING:c||(c=new AC.View.Loading),j=c;break;case AC.Events.SHOW_HOME:d||(d=new AC.View.Home),j=d;break;case AC.Events.SHOW_ABOUT:f||(f=new AC.View.About),j=f;break;case AC.Events.SHOW_PORTFOLIO:e||(e=new AC.View.Portfolio),e.update(i.slug,i.imgIndex),j=e;break;case AC.Events.SHOW_CONTACT:h||(h=new AC.View.Contact),j=h;break;case AC.Events.SHOW_NEWS:g||(g=new AC.View.News),j=g}j.render(),b=j};return i(),{displayPage:l}},AC.DataManager=AC.DataManager||{currentEvent:null,currentSlug:null,dataLoaded:!1,check:function(a,b){var c=this;switch(c.currentEvent=a,c.currentSlug=b,c.currentEvent){case AC.Events.SHOW_HOME:case AC.Events.SHOW_ABOUT:case AC.Events.SHOW_PORTFOLIO:case AC.Events.SHOW_CONTACT:case AC.Events.SHOW_NEWS:c.dataLoaded?AC.EventManager.trigger(c.currentEvent,c.currentSlug):c.getData()}},getData:function(){console.log("get data");var a=this;$.get(AC.Locations.JSON,function(b){console.log("data",b),AC.Data.JSON=b,a.dataLoaded=!0,a.check(a.currentEvent,a.currentSlug)},"json")}},AC.TemplateManager=AC.TemplateManager||{templates:{},get:function(a,b,c){if(this.templates[a])return c(this.templates[a]);var d=AC.Locations.Templates+b,e=$.trafficCop(d),f=this;e.done(function(b){var d=_.template(b);f.templates[a]=d,c(d)})}},AC.Router=Backbone.Router.extend({controller:null,initialize:function(){this.controller=new AC.Controller},routes:{portfolio:"_portfolioAction","portfolio/:project":"_portfolioAction","portfolio/:project/:index":"_portfolioAction",about:"_aboutAction",contact:"_contactAction",news:"_newsAction","news/:slug":"_newsAction","*actions":"_defaultAction"},_portfolioAction:function(a,b){console.log("PF"),this.controller.displayPage(AC.Events.SHOW_PORTFOLIO,!0,{slug:a,imgIndex:b})},_aboutAction:function(){console.log("about"),this.controller.displayPage(AC.Events.SHOW_ABOUT,!0)},_contactAction:function(){console.log("contact"),this.controller.displayPage(AC.Events.SHOW_CONTACT,!0)},_newsAction:function(a){console.log("news"),this.controller.displayPage(AC.Events.SHOW_NEWS,!0,a)},_defaultAction:function(){console.log("home"),this.controller.displayPage(AC.Events.SHOW_HOME,!0)}}),AC.Model.About=Backbone.Model.extend({defaults:{id:0,title:"",slug:""},update:function(){console.log("test",AC.Data.JSON.about)}}),AC.Model.Item=Backbone.Model.extend({defaults:{id:0,title:"",slug:""},initialize:function(){},parse:function(a){return this.id=a.id,this.title=a.title,this.slug=a.slug,this}}),AC.Model.News=Backbone.Model.extend({defaults:{id:0,title:"",slug:""},initialize:function(){this.params.news=AC.Data.JSON.news},parse:function(a){return this.id=a.id,this.title=a.title,this.slug=a.slug,this}}),AC.Collection.ItemCollection=Backbone.Collection.extend({model:AC.Model.Item,url:"/data/items.json",initialize:function(){},parse:function(a){return a.items}}),AC.View.Base=Backbone.View.extend({id:"",path:"",el:".main-content",tpl:null,collection:null,slug:"",params:{},hide:function(a){var b=$(this.el);b.fadeOut(AC.Data.FADE_OUT_DURATION,function(){a&&a()})},render:function(){this.params.models=this.collection?this.collection.models:null,this.params.slug=this.slug;var a=this;AC.TemplateManager.get(a.id,a.path,function(b){a.tpl=b,a._display()})},_display:function(){var a=this;a.slug=a.params.slug,a.prevId=$("body").attr("class"),$("body").removeClass(a.prevId).addClass(a.id),$(this.el).html(this.tpl(this.params)).fadeIn(AC.Data.FADE_IN_DURATION,function(){a._displayComplete(a)})},_displayComplete:function(){},update:function(){}}),AC.View.About=AC.View.Base.extend({id:"about",path:"about.html",initialize:function(){this.params.about=AC.Data.JSON.about}}),AC.View.Contact=AC.View.Base.extend({id:"contact",path:"contact.html",initialize:function(){this.params.contact=AC.Data.JSON.contact}}),AC.View.Home=AC.View.Base.extend({id:"home",path:"home.html",preload:null,initialize:function(){$("#wrapper").append($(AC.Spinner.el)),this.preload=new createjs.LoadQueue(!0);var a=this;this.preload.addEventListener("complete",function(){a.handleComplete()}),this.preload.addEventListener("fileload",this.handleFileLoad),this.preload.loadFile({src:"img/bg.jpg",id:"home-bg"}),this.preload.loadFile("img/axel-chang.jpg"),this.preload.loadFile("img/axel-chang-tablet.jpg")},handleComplete:function(){$("body").data("home-preload",!0),$(AC.Spinner.el).remove()},handleFileLoad:function(a){"home-bg"===a.item.id&&($(".home").addClass("home-loaded"),$("#img-home").attr("src","img/bg.jpg"))},hide:function(a){$(".home").removeClass("home-loaded");var b=$(this.el);b.fadeOut(AC.Data.FADE_OUT_DURATION,function(){a&&a()})},_displayComplete:function(){$("body").data("home-preload")&&($(".home").addClass("home-loaded"),$("#img-home").attr("src","img/bg.jpg"))}}),AC.View.Loading=AC.View.Base.extend({id:"loading",path:"loading.html"}),AC.View.News=AC.View.Base.extend({id:"news",path:"news.html",newsSwipe:null,initialize:function(){this.params.news=AC.Data.JSON.news},_displayComplete:function(){this.newsSwipe=new Swipe(document.getElementById("news-slider"),{callback:this._callbackSwipe}),this.initProjectNav()},initProjectNav:function(){var a=this.newsSwipe,b=$(".news-list .news-nav");$(".next",b).on("click",function(b){b.preventDefault(),a.next()}),$(".prev",b).on("click",function(b){b.preventDefault(),a.prev()})}}),AC.View.Portfolio=AC.View.Base.extend({id:"portfolio",path:"portfolio.html",initedLinks:!1,slug:null,detailSwipe:null,preloadImg:null,preloadedImgAll:!1,preloadBG:null,initialize:function(){this.params.projects=AC.Data.JSON.portfolio},hide:function(a){$("body").data("all-img-loaded")===!0&&(this.preloadedImgAll=!0);var b=$(this.el);b.fadeOut(AC.Data.FADE_OUT_DURATION,function(){a&&a()})},_displayComplete:function(){$(".project a, .project-detail .project-global-nav a").on("click",function(a){a.preventDefault(),AC.AppRouter.navigate($(this).attr("href"),!0)}),this.detailSwipe=new Swipe(document.getElementById("detail-slider"),{callback:this._callbackSwipe}),this.preloadedImgAll?this.prepImages():(this.addLoaders(".project"),this.initImgPreload()),this.addLoaders(".mouse-move"),this.initBGPreload(),this.initProjectNav()},addLoaders:function(a){$(a).each(function(a,b){var c=$(AC.Spinner.el).clone();$(b).append(c)})},_callbackSwipe:function(a){$(".current-index .current").html(a+1)},initImgPreload:function(){var a,b=[];$(".to-load").each(function(c,d){a={},a.src=$(d).data("src"),a.id=$(d).attr("src"),b.push(a)}),this.preloadImg=new createjs.LoadQueue(!0),this.preloadImg.addEventListener("fileload",this.handleFileLoad),this.preloadImg.addEventListener("complete",this.handleComplete),this.preloadImg.loadManifest(b)},initBGPreload:function(){var a,b=[];$(".to-load-bg").each(function(c,d){a={},a.src=$(d).data("src"),a.id=$(d).data("src"),b.push(a)}),this.preloadBG=new createjs.LoadQueue(!0),this.preloadBG.addEventListener("fileload",this.handleFileLoadBG),this.preloadBG.loadManifest(b)},handleComplete:function(){$("body").data("all-img-loaded",!0)},handleFileLoad:function(a){var b=$("[src='"+a.item.id+"']");b.removeClass("to-load").attr("src",a.item.src).addClass("loaded"),b.parents(".project").find(".spinner").remove()},handleFileLoadBG:function(a){$("[data-src='"+a.item.id+"']").removeClass("to-load-bg").attr("src",a.item.src).addClass("loaded-bg")},prepImages:function(){$(".to-load").each(function(a,b){$(b).removeClass("to-load").attr("src",$(b).data("src")).addClass("loaded")})},initProjectNav:function(){var a=this.detailSwipe,b=$(".project-detail .project-nav");$(".next",b).on("click",function(b){b.preventDefault(),a.next()}),$(".prev",b).on("click",function(b){b.preventDefault(),a.prev()})},update:function(a,b){var c=this,d=this.params.projects;this.imgIndex=b,this.slug=a,this.slug?(this.id="portfolio-detail",_.each(d,function(a,b){a.slug==c.slug&&(c.params.project=a,c.params.previous=b>0?d[b-1]:null,c.params.next=b<d.length?d[b+1]:null)})):this.id="portfolio"}}),AC.View.Components.Zoom=Backbone.View.extend({initialize:function(){}});